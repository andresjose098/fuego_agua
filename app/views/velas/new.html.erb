<h2 style="font-size: 28px; margin-bottom: 20px;">üïØÔ∏è Personalizar Vela</h2>

<%= form_with model: @vela, local: true do |f| %>

  <!-- Modelo -->
<div style="margin-bottom: 20px;">
  <label style="font-size: 18px;"><strong>Modelo</strong></label><br>
  <%= f.select :modelo, ['Cl√°sico', 'Moderno'], {}, id: "modelo-select", style: "padding: 10px; font-size: 16px; width: 130px;" %>
</div>

  <!-- Estilo -->
  <div style="margin-bottom: 20px;">
    <label style="font-size: 18px;"><strong>Estilo</strong></label><br>
    <%= f.radio_button :estilo, "Color", id: "estilo_color" %>
    <label for="estilo_color" style="margin-right: 15px;">üé® Color</label>

    <%= f.radio_button :estilo, "Texto", id: "estilo_texto" %>
    <label for="estilo_texto" style="margin-right: 15px;">üÖ£ Texto</label>

    <%= f.radio_button :estilo, "Dibujos", id: "estilo_dibujos" %>
    <label for="estilo_dibujos">‚úèÔ∏è Dibujos</label>
  </div>

 <!-- Paleta de colores visual -->
<div style="margin-bottom: 30px;">
  <label style="font-size: 18px;"><strong>Color de la vela</strong></label><br>
  <div id="color-options" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
    <% colors = ['#f6e2a6', '#f4c5ab', '#dfb6aa', '#3e7a8d', '#2e504d', '#7ebd9c', '#e9e9e9', '#222831'] %>
    <% colors.each_with_index do |color, i| %>
      <label class="color-circle" data-index="<%= i %>">
        <%= f.radio_button :color, color, id: "color_#{i}", style: "display: none;" %>
        <span class="circle" style="background-color: <%= color %>;" data-for="color_<%= i %>"></span>
      </label>
    <% end %>
  </div>
</div>

<style>
  .circle {
    display: inline-block;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px solid #ccc;
    transition: all 0.3s ease;
  }

  .circle.selected {
    border: 4px solid #f39c12;
    box-shadow: 0 0 6px #f39c12;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const radios = document.querySelectorAll('input[type=radio][name="vela[color]"]');
    const circles = document.querySelectorAll('.circle');

    radios.forEach(radio => {
      radio.addEventListener('change', () => {
        circles.forEach(c => c.classList.remove('selected'));
        const selected = document.querySelector(`span[data-for="${radio.id}"]`);
        if (selected) selected.classList.add('selected');
      });
    });

    // Si hay un valor preseleccionado (al recargar con errores)
    const checked = document.querySelector('input[type=radio][name="vela[color]"]:checked');
    if (checked) {
      const selected = document.querySelector(`span[data-for="${checked.id}"]`);
      if (selected) selected.classList.add('selected');
    }
  });

    document.addEventListener("DOMContentLoaded", () => {
    const modeloSelect = document.getElementById("modelo-select");
    const previewImg = document.getElementById("vela-preview-img");

    modeloSelect.addEventListener("change", () => {
      const modelo = modeloSelect.value.toLowerCase(); // "cl√°sico" o "moderno"
      const imagen = modelo === "moderno" ? "vela_moderna.jpg" : "vela_clasica.jpg";
      previewImg.src = `/assets/${imagen}`;
    });
  });


  
     document.addEventListener("DOMContentLoaded", () => {
    const radios = document.querySelectorAll('input[type=radio][name="vela[color]"]');
    const circles = document.querySelectorAll('.circle');
    const modeloSelect = document.getElementById("modelo-select");
    const previewImg = document.getElementById("vela-preview-img");
    const colorOverlay = document.getElementById("color-overlay");

    // === Cambiar imagen seg√∫n el modelo ===
    modeloSelect.addEventListener("change", () => {
      const modelo = modeloSelect.value.toLowerCase(); // cl√°sico o moderno
      const imagen = modelo === "moderno" ? "vela_moderna.png" : "vela_clasica.jpg";
      previewImg.src = `/assets/${imagen}`;
    });

    // === Cambiar color del overlay (sin tocar fondo) ===
    function updateColorOverlay(color) {
      colorOverlay.style.backgroundColor = color;
    }

    radios.forEach(radio => {
      radio.addEventListener('change', () => {
        // Marcar el c√≠rculo
        circles.forEach(c => c.classList.remove('selected'));
        const selected = document.querySelector(`span[data-for="${radio.id}"]`);
        if (selected) selected.classList.add('selected');

        // Aplicar color
        updateColorOverlay(radio.value);
      });
    });

    // Si hay color preseleccionado
    const checked = document.querySelector('input[name="vela[color]"]:checked');
    if (checked) updateColorOverlay(checked.value);
  });

   
</script>


  <!-- Vista previa -->
<div style="margin-bottom: 30px;">
  <label style="font-size: 18px;"><strong>Vista previa</strong></label><br>
  <div style="position: relative; display: inline-block; margin-top: 10px; width: 250px;">
    <img id="vela-preview-img" src="<%= asset_path('vela_clasica.jpg') %>" width="100%" style="border-radius: 8px;">
    <div id="color-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 8px; background-color: transparent; opacity: 0.3; pointer-events: none;"></div>
  </div>
</div>




<% end %>
